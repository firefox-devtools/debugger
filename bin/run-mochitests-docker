#!/bin/sh

TARGET=firefox-panel ./node_modules/.bin/webpack

sudo mkdir /dev/mqueue
sudo mount -t mqueue none /dev/mqueue

docker run -it \
  -v `pwd`/public/build/bundle.js:/firefox/devtools/client/debugger/new/bundle.js \
  -v `pwd`/public/build/pretty-print-worker.js:/firefox/devtools/client/debugger/new/pretty-print-worker.js \
  -v `pwd`/public/build/styles.css:/firefox/devtools/client/debugger/new/styles.css \
  -v `pwd`/public/images:/firefox/devtools/client/debugger/new/images \
  -v `pwd`/public/js/test/mochitest:/firefox/devtools/client/debugger/new/test/mochitest \
  -v "/tmp/.X11-unix:/tmp/.X11-unix:rw" \
  -e "DISPLAY=unix$DISPLAY" \
  -e "XDG_RUNTIME_DIR=$TMPDIR" \
  --ipc host \
  jlongster/mochitest-runner \
  /bin/bash -c "export SHELL=/bin/bash; touch devtools/client/debugger/new/test/mochitest/browser.ini && ./mach mochitest --subsuite devtools devtools/client/debugger/new/test/mochitest/"
